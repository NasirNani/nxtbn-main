{% extends "account/base.html" %}
{% load i18n currency %}
{% get_current_language as LANGUAGE_CODE %}

{% block head_title %}{% if LANGUAGE_CODE == 'tr' %}Odeme | Flexy Medical{% else %}Payment | Flexy Medical{% endif %}{% endblock %}

{% block content %}
<main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12 min-h-screen">
    <div class="rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2219] p-6 lg:p-8">
        <h1 class="text-2xl font-bold text-text-main dark:text-white">{% if LANGUAGE_CODE == 'tr' %}Odeme Adimi{% else %}Payment Step{% endif %}</h1>
        <p class="mt-2 text-gray-500 dark:text-gray-300">{% if LANGUAGE_CODE == 'tr' %}Siparisiniz olusturuldu. Odemeyi tamamlayin.{% else %}Your order is created. Complete payment to finalize it.{% endif %}</p>

        <div class="mt-6 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
            <p class="text-sm text-gray-500">{% if LANGUAGE_CODE == 'tr' %}Siparis{% else %}Order{% endif %}: #{{ transaction.order.id|stringformat:"s"|slice:":8"|upper }}</p>
            <p class="text-xl font-bold mt-2 text-text-main dark:text-white">{{ transaction.amount|try_currency }}</p>
        </div>

        {% if payment_url %}
            <a href="{{ payment_url }}" class="mt-6 inline-flex items-center px-5 py-2.5 rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark transition-colors">
                {% if LANGUAGE_CODE == 'tr' %}PayTR ile Ode{% else %}Pay with PayTR{% endif %}
            </a>
            <p class="mt-2 text-xs text-gray-500">{% if LANGUAGE_CODE == 'tr' %}PayTR sayfasina yonlendirileceksiniz.{% else %}You will be redirected to PayTR.{% endif %}</p>
        {% else %}
            <p class="mt-6 text-sm text-amber-600">{% if LANGUAGE_CODE == 'tr' %}Gelistirme modu aktif. Gercek PayTR anahtarlari tanimli degil.{% else %}Development mode active. Real PayTR credentials are missing.{% endif %}</p>
            <div class="mt-3 flex gap-3">
                <form method="post" action="{% url 'payment_simulate' transaction.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="outcome" value="success">
                    <button type="submit" class="px-4 py-2.5 rounded-lg bg-green-600 text-white font-semibold hover:bg-green-700 transition-colors">{% if LANGUAGE_CODE == 'tr' %}Basarili Ode{% else %}Simulate Success{% endif %}</button>
                </form>
                <form method="post" action="{% url 'payment_simulate' transaction.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="outcome" value="fail">
                    <button type="submit" class="px-4 py-2.5 rounded-lg border border-red-300 text-red-700 font-semibold hover:bg-red-50 transition-colors">{% if LANGUAGE_CODE == 'tr' %}Basarisiz Ode{% else %}Simulate Fail{% endif %}</button>
                </form>
            </div>
        {% endif %}
    </div>
</main>
{% endblock content %}
