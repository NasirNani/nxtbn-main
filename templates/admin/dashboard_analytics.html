{% extends "admin/base_site.html" %}
{% load i18n %}

{% block content %}
<div id="content-main">
    <div class="ops-header">
        <h1>Operasyon Panosu</h1>
        <p class="ops-note">Siparis, satis, stok ve yorum moderasyonunun genel ozeti.</p>
    </div>

    <p class="ops-actions">
        <a href="{% url 'admin:product_product_import_csv' %}" class="button">Urun CSV Ice Aktar</a>
        <a href="{% url 'admin:product_product_export_csv' %}" class="button">Urun CSV Disa Aktar</a>
        <a href="{% url 'admin:order_order_export_csv' %}" class="button">Siparis CSV Disa Aktar</a>
    </p>

    <div class="ops-grid">
        <div class="module ops-card"><h2>Toplam Siparis</h2><p class="ops-metric">{{ metrics.orders_total }}</p></div>
        <div class="module ops-card"><h2>Bekleyen</h2><p class="ops-metric">{{ metrics.orders_pending }}</p></div>
        <div class="module ops-card"><h2>Isleniyor</h2><p class="ops-metric">{{ metrics.orders_processing }}</p></div>
        <div class="module ops-card"><h2>Odendi</h2><p class="ops-metric">{{ metrics.orders_paid }}</p></div>
        <div class="module ops-card"><h2>30 Gunluk Satis</h2><p class="ops-metric">&#8378;{{ metrics.sales_30_days|floatformat:2 }}</p></div>
        <div class="module ops-card"><h2>Toplam Urun</h2><p class="ops-metric">{{ metrics.products_total }}</p></div>
        <div class="module ops-card"><h2>Yayinda Urun</h2><p class="ops-metric">{{ metrics.products_live }}</p></div>
        <div class="module ops-card"><h2>Dusuk Stok</h2><p class="ops-metric">{{ metrics.low_stock_count }}</p></div>
        <div class="module ops-card"><h2>Bekleyen Yorum</h2><p class="ops-metric">{{ metrics.pending_reviews }}</p></div>
    </div>

    <div class="ops-grid-2">
        <div class="module ops-card">
            <h2>Siparis Sirasi</h2>
            <table class="ops-table">
                <thead>
                    <tr><th>ID</th><th>Durum</th><th>Tutar</th><th>Tarih</th></tr>
                </thead>
                <tbody>
                    {% for order in order_queue %}
                    <tr>
                        <td><a href="{% url 'admin:order_order_change' order.id %}">{{ order.id|stringformat:"s"|slice:":8"|upper }}</a></td>
                        <td>{{ order.get_status_display }}</td>
                        <td>&#8378;{{ order.total|floatformat:2 }}</td>
                        <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Bekleyen siparis yok.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="module ops-card">
            <h2>Dusuk Stoklu Varyantlar</h2>
            <table class="ops-table">
                <thead>
                    <tr><th>Urun</th><th>Varyant</th><th>Stok</th></tr>
                </thead>
                <tbody>
                    {% for variant in low_stock_variants %}
                    <tr>
                        <td><a href="{% url 'admin:product_product_change' variant.product.id %}">{{ variant.product.name }}</a></td>
                        <td>{{ variant.name|default:"Default" }}</td>
                        <td>{{ variant.stock }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3">Dusuk stoklu urun yok.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="ops-grid-2">
        <div class="module ops-card">
            <h2>Yorum Moderasyon Sirasi</h2>
            <table class="ops-table">
                <thead>
                    <tr><th>Urun</th><th>Kullanici</th><th>Puan</th><th>Tarih</th></tr>
                </thead>
                <tbody>
                    {% for review in review_queue %}
                    <tr>
                        <td>{{ review.product.name }}</td>
                        <td>{{ review.user.email }}</td>
                        <td>{{ review.rating }}/5</td>
                        <td>{{ review.created_at|date:"Y-m-d H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Bekleyen yorum yok.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="module ops-card">
            <h2>Gunluk Satis (30 Gun)</h2>
            <table class="ops-table">
                <thead>
                    <tr><th>Tarih</th><th>Siparis</th><th>Toplam</th></tr>
                </thead>
                <tbody>
                    {% for row in sales_by_day %}
                    <tr>
                        <td>{{ row.day }}</td>
                        <td>{{ row.count }}</td>
                        <td>&#8378;{{ row.total|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3">Son 30 gunde satis verisi yok.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
