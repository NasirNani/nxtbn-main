{% extends "account/base.html" %}
{% load i18n currency %}
{% get_current_language as LANGUAGE_CODE %}

{% block head_title %}{% if LANGUAGE_CODE == 'tr' %}Siparis Detayi | Flexy Medical{% else %}Order Details | Flexy Medical{% endif %}{% endblock %}

{% block content %}
<main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 min-h-screen">
    <a href="{% url 'account_orders' %}" class="inline-flex items-center text-sm text-gray-500 hover:text-primary transition-colors mb-4">
        <span class="material-icons text-base mr-1">arrow_back</span>
        {% if LANGUAGE_CODE == 'tr' %}Siparislerime Don{% else %}Back to My Orders{% endif %}
    </a>
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <div>
            <h1 class="text-3xl font-bold text-text-main dark:text-white">{% if LANGUAGE_CODE == 'tr' %}Siparis Detayi{% else %}Order Details{% endif %}</h1>
            <p class="text-gray-500 mt-1">#{{ order.id|stringformat:"s"|slice:":8"|upper }} - {{ order.get_status_display }}</p>
        </div>
        <div class="flex gap-3">
            {% if invoice %}
            <a href="{% url 'invoice_download' order.id %}" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 hover:text-primary transition-colors">{% if LANGUAGE_CODE == 'tr' %}Fatura{% else %}Invoice{% endif %}</a>
            {% endif %}
            <a href="{% url 'order_tracking' order.id %}" class="px-4 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark transition-colors">{% if LANGUAGE_CODE == 'tr' %}Takip{% else %}Tracking{% endif %}</a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <section class="lg:col-span-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2219] p-6">
            <h2 class="text-xl font-semibold text-text-main dark:text-white mb-4">{% if LANGUAGE_CODE == 'tr' %}Siparis Kalemleri{% else %}Order Items{% endif %}</h2>
            <div class="space-y-3">
                {% for item in order.items.all %}
                <article class="rounded-lg border border-gray-200 dark:border-gray-700 p-4 flex justify-between gap-4">
                    <div>
                        <p class="font-semibold text-text-main dark:text-white">{{ item.product_name }}</p>
                        <p class="text-xs text-gray-500">SKU: {{ item.sku }} | {% if LANGUAGE_CODE == 'tr' %}Adet{% else %}Qty{% endif %}: {{ item.quantity }}</p>
                    </div>
                    <p class="font-semibold text-text-main dark:text-white">{{ item.line_total|try_currency }}</p>
                </article>
                {% endfor %}
            </div>
        </section>

        <aside class="rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2c2219] p-6">
            <h2 class="text-xl font-semibold text-text-main dark:text-white mb-4">{% if LANGUAGE_CODE == 'tr' %}Ozet{% else %}Summary{% endif %}</h2>
            <ul class="space-y-2 text-sm">
                <li class="flex justify-between"><span class="text-gray-500">{% if LANGUAGE_CODE == 'tr' %}Ara Toplam{% else %}Subtotal{% endif %}</span><span>{{ order.subtotal|try_currency }}</span></li>
                <li class="flex justify-between"><span class="text-gray-500">{% if LANGUAGE_CODE == 'tr' %}Indirim{% else %}Discount{% endif %}</span><span>-{{ order.discount|try_currency }}</span></li>
                <li class="flex justify-between"><span class="text-gray-500">{% if LANGUAGE_CODE == 'tr' %}Vergi{% else %}Tax{% endif %}</span><span>{{ order.tax|try_currency }}</span></li>
                <li class="flex justify-between"><span class="text-gray-500">{% if LANGUAGE_CODE == 'tr' %}Kargo{% else %}Shipping{% endif %}</span><span>{{ order.shipping|try_currency }}</span></li>
                <li class="border-t border-gray-200 dark:border-gray-700 pt-2 flex justify-between font-semibold"><span>{% if LANGUAGE_CODE == 'tr' %}Toplam{% else %}Total{% endif %}</span><span>{{ order.total|try_currency }}</span></li>
            </ul>

            <form method="post" action="{% url 'order_reorder' order.id %}" class="mt-6">
                {% csrf_token %}
                <button type="submit" class="w-full px-4 py-2.5 rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark transition-colors">{% if LANGUAGE_CODE == 'tr' %}Tekrar Siparis Ver{% else %}Reorder{% endif %}</button>
            </form>

            {% if order.cancellation_requested %}
            <p class="mt-4 text-sm text-amber-600">{% if LANGUAGE_CODE == 'tr' %}Iptal talebiniz alinmistir.{% else %}Your cancellation request has been received.{% endif %}</p>
            {% elif order.status != 'cancelled' and order.status != 'delivered' and order.status != 'refunded' %}
            <form method="post" action="{% url 'order_cancel_request' order.id %}" class="mt-3 space-y-2">
                {% csrf_token %}
                <input type="text" name="reason" placeholder="{% if LANGUAGE_CODE == 'tr' %}Iptal nedeni (opsiyonel){% else %}Cancel reason (optional){% endif %}" class="w-full rounded-lg border-gray-300 dark:border-gray-700 dark:bg-gray-800">
                <button type="submit" class="w-full px-4 py-2.5 rounded-lg border border-red-300 text-red-700 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">{% if LANGUAGE_CODE == 'tr' %}Iptal Talebi Olustur{% else %}Request Cancellation{% endif %}</button>
            </form>
            {% endif %}
        </aside>
    </div>
</main>
{% endblock content %}
